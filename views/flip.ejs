<!DOCTYPE html>
<html lang="<%= lang === 'zh' ? 'zh-CN' : 'en' %>">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= lang === 'zh' ? 'ç¿»å¡ç‰Œ' : 'Card Flip' %></title>
    <link rel="stylesheet" href="/styles.css">
    <style>
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            color: #fff;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #00c853;
        }

        .header h1 {
            margin: 0;
            color: #00c853;
        }

        .nav-links {
            display: flex;
            gap: 1rem;
            align-items: center;
            color: #ccc;
        }

        .nav-links a {
            color: #fff;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .nav-links a:hover {
            background: rgba(0, 200, 83, 0.2);
            transform: translateY(-2px);
        }

        .balance-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .balance-section h3 {
            color: #ffeb3b;
            margin: 0;
        }

        .flip-layout {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            align-items: center;
        }

        .flip-grid {
            display: grid;
            grid-template-columns: repeat(3, 110px);
            gap: 1rem;
        }

        .flip-card {
            width: 110px;
            height: 140px;
            border-radius: 12px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.02));
            border: 2px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .flip-card:hover:not(.flipped):not(.disabled) {
            transform: translateY(-4px);
            box-shadow: 0 6px 20px rgba(255, 255, 255, 0.15);
        }

        .flip-card.flipped.good {
            background: linear-gradient(135deg, rgba(0, 200, 83, 0.6), rgba(0, 200, 83, 0.2));
            border-color: rgba(0, 200, 83, 0.8);
        }

        .flip-card.flipped.bad {
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.6), rgba(244, 67, 54, 0.2));
            border-color: rgba(244, 67, 54, 0.8);
        }

        .flip-card.disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }

        .flip-card .card-label {
            text-align: center;
            font-size: 1rem;
            color: #fff;
        }

        .status-panel {
            display: flex;
            gap: 2rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .status-box {
            background: rgba(255, 255, 255, 0.06);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            min-width: 180px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .status-box h4 {
            margin: 0 0 0.5rem;
            color: #ccc;
        }

        .status-box span {
            font-size: 1.2rem;
            color: #ffeb3b;
            font-weight: bold;
        }

        .action-row {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .action-btn {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: #fff;
            border: none;
            border-radius: 10px;
            padding: 0.8rem 1.4rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-btn.secondary {
            background: linear-gradient(135deg, #00c853, #00bfa5);
        }

        .action-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }

        .hint-text {
            color: #ccc;
            font-size: 0.9rem;
            text-align: center;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .header {
                flex-direction: column;
                gap: 1rem;
            }

            .flip-grid {
                grid-template-columns: repeat(3, 90px);
                gap: 0.8rem;
            }

            .flip-card {
                width: 90px;
                height: 120px;
            }
        }
    </style>
</head>
<body data-csrf-token="<%= csrfToken %>">
    <%- include('partials/language-switcher') %>

    <div class="container">
        <div class="header">
            <h1>ğŸƒ <%= lang === 'zh' ? 'ç¿»å¡ç‰Œ' : 'Card Flip' %></h1>
            <div class="nav-links">
                <span><%= lang === 'zh' ? 'ç”¨æˆ·' : 'User' %>ï¼š<%= username %></span>
                <a href="/">ğŸ  <%= lang === 'zh' ? 'è¿”å›é¦–é¡µ' : 'Home' %></a>
                <a href="/profile">ğŸ‘¤ <%= lang === 'zh' ? 'ä¸ªäººä¸­å¿ƒ' : 'Profile' %></a>
            </div>
        </div>

        <div class="balance-section">
            <h3>âš¡ <%= lang === 'zh' ? 'å½“å‰ç”µå¸' : 'Current Coins' %>: <span id="current-balance"><%= balance || 0 %></span> <%= lang === 'zh' ? 'ç”µå¸' : 'coins' %></h3>
        </div>

        <div class="flip-layout">
            <div class="status-panel">
                <div class="status-box">
                    <h4><%= lang === 'zh' ? 'ä¸‹ä¸€å¼ èŠ±è´¹' : 'Next Card Cost' %></h4>
                    <span id="nextCost">--</span>
                </div>
                <div class="status-box">
                    <h4><%= lang === 'zh' ? 'å·²ç¿»å¥½ç‰Œ' : 'Good Cards' %></h4>
                    <span id="goodCount">0</span>
                </div>
                <div class="status-box">
                    <h4><%= lang === 'zh' ? 'å½“å‰é€€å‡ºå¥–åŠ±' : 'Current Cashout' %></h4>
                    <span id="cashoutReward">0</span>
                </div>
            </div>

            <div class="flip-grid" id="flipGrid"></div>

            <div class="action-row">
                <button class="action-btn secondary" id="startBtn">
                    <%= lang === 'zh' ? 'å¼€å§‹æ–°ä¸€è½®' : 'Start New Round' %>
                </button>
                <button class="action-btn" id="cashoutBtn">
                    <%= lang === 'zh' ? 'ç«‹å³é€€å‡º' : 'Cash Out' %>
                </button>
            </div>

            <div class="hint-text">
                <%= lang === 'zh'
                    ? 'ç¿»åˆ°åç‰Œä¼šç«‹åˆ»ç»“æŸå¹¶è·å¾—å®‰æ…°å¥– 50 ç”µå¸ã€‚ç¿»æ»¡ 7 å¼ å¥½ç‰Œè‡ªåŠ¨è·å¾— 30000 ç”µå¸ã€‚'
                    : 'Flipping a bad card ends immediately with consolation prize of 50 coins. Flip all 7 good cards to automatically win 30000 coins.'
                %>
            </div>
        </div>

        <div style="
            max-width: 760px;
            margin: 2rem auto 0;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            font-size: 0.85rem;
            color: #ccc;
            line-height: 1.5;
            text-align: center;
        ">
            <% if (lang === 'zh') { %>
                âš ï¸ <strong>å…è´£å£°æ˜ï¼š</strong>æœ¬åŠŸèƒ½ä»…ä¾›å¨±ä¹æ¶ˆé£ï¼Œä¸æ¶‰åŠä»»ä½•å½¢å¼çš„èµŒåšã€åšå½©æˆ–çœŸå®è´§å¸ä½¿ç”¨ã€‚è™šæ‹Ÿç”µå¸æ— æ³•å…‘æ¢çœŸå®è´§å¸ã€‚ä¸¥ç¦æœªæ»¡18å‘¨å²ç”¨æˆ·ä½¿ç”¨ï¼Œè¯·ç†æ€§å¨±ä¹ã€‚
            <% } else { %>
                âš ï¸ <strong>Disclaimer:</strong> This feature is for entertainment only and does not involve any form of gambling, betting, or real money usage. Virtual coins cannot be exchanged for real money. Strictly prohibited for users under 18 years old. Please enjoy responsibly.
            <% } %>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/security-alerts.js"></script>
    <script src="/js/flip.js"></script>
</body>
</html>
