<!DOCTYPE html>
<html lang="<%= lang === 'zh' ? 'zh-CN' : 'en' %>">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= lang === 'zh' ? 'çŸ¥è¯†é—®ç­”' : 'Quiz' %></title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body data-username="<%= username %>" data-csrf-token="<%= csrfToken %>">
    <%- include('partials/language-switcher') %>

    <div class="container">
        <div class="header">
            <h1>ğŸ§ <%= lang === 'zh' ? 'åœ¨çº¿ç­”é¢˜' : 'Online Quiz' %></h1>
            <div class="nav-links">
                <span><%= lang === 'zh' ? 'ç”¨æˆ·' : 'User' %>ï¼š<%= username %></span>
                <a href="/">ğŸ  <%= lang === 'zh' ? 'è¿”å›é¦–é¡µ' : 'Home' %></a>
                <a href="/profile">ğŸ‘¤ <%= lang === 'zh' ? 'ä¸ªäººä¸­å¿ƒ' : 'Profile' %></a>
            </div>
        </div>

        <div id="user-section" class="game-section">
            <div class="balance-info">
                <h3>âš¡ <%= lang === 'zh' ? 'å½“å‰ç”µå¸' : 'Current Coins' %>: <span id="current-balance"><%= balance || 0 %></span> <%= lang === 'zh' ? 'ç”µå¸' : 'coins' %></h3>
                <p class="cost-info">
                    ğŸ’° <%= lang === 'zh' ? 'æ¸¸æˆè´¹ç”¨' : 'Game Cost' %>: 10 <%= lang === 'zh' ? 'ç”µå¸' : 'coins' %> |
                    ğŸ† <%= lang === 'zh' ? 'è·èƒœå¥–åŠ±' : 'Win Reward' %>: <%= lang === 'zh' ? 'å¾—åˆ† Ã— 2 ç”µå¸' : 'Score Ã— 2 coins' %>
                </p>
            </div>
            <p class="game-desc">
                <%= lang === 'zh'
                    ? 'æŒ‘æˆ˜çŸ¥è¯†é—®ç­”ï¼Œå±•ç¤ºä½ çš„æ™ºæ…§ï¼15é¢˜æ€»å…±30ç§’ï¼Œç­”å¯¹å¾—åˆ†ï¼Œç­”é”™ä¸æ‰£åˆ†ã€‚'
                    : 'Challenge your knowledge and show your wisdom! 15 questions in 30 seconds total. Correct answers earn points, wrong answers don\'t lose points.'
                %>
            </p>
            <button id="start-quiz-btn">
                ğŸ® <%= lang === 'zh' ? 'å¼€å§‹ç­”é¢˜ (æ¶ˆè€—10ç”µå¸)' : 'Start Quiz (Cost 10 coins)' %>
            </button>
        </div>

        <div id="quiz" style="display:none" class="quiz-section">
            <div class="quiz-header">
                <p id="timer" class="timer"><%= lang === 'zh' ? 'å‡†å¤‡ä¸­...' : 'Preparing...' %></p>
                <p id="progress" class="progress"><%= lang === 'zh' ? 'é¢˜ç›®' : 'Question' %> 1/15</p>
            </div>
            <div class="quiz-container">
                <div id="question" class="question"></div>
                <div id="options" class="options"></div>
            </div>
        </div>

        <div id="result" class="result-section"></div>

        <div id="leaderboard" class="leaderboard-section">
            <div id="current-game-result" style="
                background: rgba(255, 255, 255, 0.1);
                padding: 1.5rem;
                border-radius: 12px;
                margin-bottom: 2rem;
                text-align: center;
                display: none;
            ">
                <h3 style="color: #00c853; margin-bottom: 1rem;">ğŸ“Š <%= lang === 'zh' ? 'æœ¬å±€ç»“æœ' : 'Current Game Result' %></h3>
                <div id="current-score" style="font-size: 1.3rem; color: #ffeb3b; margin-bottom: 0.5rem;"></div>
                <div id="current-reward" style="font-size: 1.1rem; color: #00c853;"></div>
            </div>

            <h2>ğŸ† <%= lang === 'zh' ? 'ä»Šæ—¥æ’è¡Œæ¦œ' : 'Today\'s Leaderboard' %></h2>
            <div class="refresh-controls">
                <button class="refresh-btn" id="refresh-leaderboard-btn">ğŸ”„ <%= lang === 'zh' ? 'åˆ·æ–°æ’è¡Œæ¦œ' : 'Refresh Leaderboard' %></button>
                <small style="display: block; margin-top: 5px;">
                    <%= lang === 'zh' ? 'æ’è¡Œæ¦œæ˜¾ç¤ºæ¯ä¸ªç”¨æˆ·æœ€é«˜åˆ†' : 'Leaderboard shows highest score per user' %>
                </small>
            </div>
            <table class="leaderboard-table">
                <thead>
                    <tr>
                        <th><%= lang === 'zh' ? 'æ’å' : 'Rank' %></th>
                        <th><%= lang === 'zh' ? 'ç”¨æˆ·å' : 'Username' %></th>
                        <th><%= t.game.score %></th>
                        <th><%= lang === 'zh' ? 'å®Œæˆæ—¶é—´' : 'Completed At' %></th>
                    </tr>
                </thead>
                <tbody id="leaderboard-body">
                    <tr><td colspan="4"><%= t.common.loading %></td></tr>
                </tbody>
            </table>
        </div>


        <div style="
            max-width: 760px;
            margin: 2rem auto 0;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            font-size: 0.85rem;
            color: #ccc;
            line-height: 1.5;
            text-align: center;
        ">
            <% if (lang === 'zh') { %>
                âš ï¸ <strong>å…è´£å£°æ˜ï¼š</strong>æœ¬é—®ç­”æ¸¸æˆä»…ä¾›å¨±ä¹å­¦ä¹ ï¼Œç§¯åˆ†ä¸ºè™šæ‹Ÿå¥–åŠ±ï¼Œæ— æ³•å…‘æ¢çœŸå®è´§å¸æˆ–æœ‰ä»·ç‰©å“ã€‚å‚ä¸å®Œå…¨å…è´¹ï¼Œç¬¦åˆç›¸å…³æ³•å¾‹æ³•è§„ã€‚è¯·ç†æ€§æ¸¸æˆï¼Œä¸¥ç¦æœªæ»¡18å‘¨å²ç”¨æˆ·ä½¿ç”¨ã€‚
            <% } else { %>
                âš ï¸ <strong>Disclaimer:</strong> This quiz game is for entertainment and learning only. Points are virtual rewards that cannot be exchanged for real money or valuable goods. Participation is completely free and complies with relevant laws. Please play responsibly. Strictly prohibited for users under 18 years old.
            <% } %>
        </div>
    </div>

    <style>
    .container {
        max-width: 900px;
        margin: 0 auto;
        padding: 2rem;
        background: rgba(0, 0, 0, 0.8);
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        color: #fff;
    }

    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid #00c853;
    }

    .header h1 {
        margin: 0;
        color: #00c853;
    }

    .nav-links {
        display: flex;
        gap: 1rem;
        align-items: center;
        color: #ccc;
    }

    .nav-links a {
        color: #fff;
        text-decoration: none;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
    }

    .nav-links a:hover {
        background: rgba(0, 200, 83, 0.2);
        transform: translateY(-2px);
    }

    .game-section {
        text-align: center;
        padding: 2rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        margin-bottom: 2rem;
    }

    .game-desc {
        color: #ccc;
        margin-bottom: 2rem;
        font-size: 1.1rem;
        line-height: 1.6;
    }

    .game-section button {
        background: linear-gradient(45deg, #4caf50, #45a049);
        color: white;
        border: none;
        padding: 15px 40px;
        font-size: 18px;
        font-weight: bold;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
    }

    .game-section button:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
    }

    .balance-info {
        background: rgba(255, 255, 255, 0.1);
        padding: 1.5rem;
        border-radius: 12px;
        margin-bottom: 2rem;
        text-align: center;
    }

    .balance-info h3 {
        color: #ffeb3b;
        margin-bottom: 0.5rem;
    }

    .cost-info {
        color: #ccc;
        font-size: 0.9rem;
    }

    .quiz-section {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        padding: 2rem;
        margin-bottom: 2rem;
    }

    .quiz-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
    }

    .timer {
        font-size: 1.5rem;
        color: #ff6b6b;
        font-weight: bold;
        background: rgba(255, 107, 107, 0.1);
        padding: 0.5rem 1rem;
        border-radius: 8px;
        margin: 0;
    }

    .progress {
        color: #00c853;
        font-weight: bold;
        font-size: 1.1rem;
        margin: 0;
    }

    .quiz-container {
        background: rgba(255, 255, 255, 0.1);
        padding: 2rem;
        border-radius: 12px;
    }

    .question {
        font-size: 1.3rem;
        margin-bottom: 2rem;
        padding: 1.5rem;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        border-left: 4px solid #00c853;
        line-height: 1.6;
    }

    .options {
        display: grid;
        gap: 1rem;
    }

    .option {
        padding: 1rem 1.5rem;
        border: 2px solid rgba(255, 255, 255, 0.2);
        cursor: pointer;
        border-radius: 10px;
        transition: all 0.3s ease;
        background: rgba(255, 255, 255, 0.05);
        font-size: 1rem;
    }

    .option:hover {
        background: rgba(0, 200, 83, 0.1);
        border-color: #00c853;
        transform: translateX(5px);
    }

    .option.selected {
        background: linear-gradient(135deg, #00c853, #00bfa5);
        color: white;
        border-color: #00c853;
        transform: translateX(5px);
    }

    .option.locked {
        cursor: not-allowed;
        opacity: 0.6;
    }

    .result-section {
        text-align: center;
        padding: 2rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        margin-bottom: 2rem;
        font-size: 1.2rem;
        display: none;
    }

    .result-section.show {
        display: block;
    }

    .leaderboard-section {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        padding: 2rem;
    }

    .leaderboard-section h2 {
        color: #00c853;
        margin-bottom: 1rem;
        text-align: center;
    }

    .refresh-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
    }

    .refresh-btn {
        padding: 0.5rem 1rem;
        background: linear-gradient(135deg, #00c853, #00bfa5);
        border: none;
        border-radius: 6px;
        color: white;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .refresh-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 200, 83, 0.4);
    }

    .refresh-controls small {
        color: #888;
        font-size: 0.85rem;
    }

    .leaderboard-table {
        width: 100%;
        border-collapse: collapse;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        overflow: hidden;
    }

    .leaderboard-table th {
        background: linear-gradient(135deg, #00c853, #00bfa5);
        color: white;
        padding: 1rem;
        text-align: left;
        font-weight: bold;
    }

    .leaderboard-table td {
        padding: 0.8rem 1rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .leaderboard-table tr:hover {
        background: rgba(255, 255, 255, 0.1);
    }

    .leaderboard-table tr:nth-child(1) td:first-child::before { content: "ğŸ¥‡ "; }
    .leaderboard-table tr:nth-child(2) td:first-child::before { content: "ğŸ¥ˆ "; }
    .leaderboard-table tr:nth-child(3) td:first-child::before { content: "ğŸ¥‰ "; }

    @media (max-width: 768px) {
        .container {
            padding: 1rem;
        }
        
        .header {
            flex-direction: column;
            gap: 1rem;
        }
        
        .quiz-header {
            flex-direction: column;
            gap: 1rem;
        }
        
        .question {
            font-size: 1.1rem;
        }
    }
    </style>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/security-alerts.js"></script>
    <script src="/js/quiz.js"></script>
</body>
</html>
