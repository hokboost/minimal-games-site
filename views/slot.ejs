<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KingBoost Âπ∏ËøêËÄÅËôéÊú∫</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé∞ KingBoost Âπ∏ËøêËÄÅËôéÊú∫</h1>
            <div class="nav-links">
                <span>Áî®Êà∑Ôºö<%= username %></span>
                <a href="/">üè† ËøîÂõûÈ¶ñÈ°µ</a>
                <a href="/profile">üë§ ‰∏™‰∫∫‰∏≠ÂøÉ</a>
            </div>
        </div>
        
        <div id="slot" class="slot-area">
            <div class="slot-reels">
                <span id="r1">Âä†ËΩΩ‰∏≠</span>
                <span id="r2">Âä†ËΩΩ‰∏≠</span>
                <span id="r3">Âä†ËΩΩ‰∏≠</span>
            </div>
            <button id="spinBtn">ÁÇπÂáªÊäΩÂ•ñ</button>
        </div>
        <p id="rewardResult" class="result-text"></p>
        <div style="
            max-width: 800px;
            margin: 2rem auto 0;
            padding: 1rem 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            font-size: 0.9rem;
            color: #ccc;
            text-align: center;
            line-height: 1.5;
        ">
            ‚ö†Ô∏è <strong>Disclaimer:</strong> This slot machine feature is intended for amusement only. It does not involve any form of gambling, betting, or the use of real currency. No monetary prizes are offered or can be won. Participation is entirely free, and no purchase is necessary. This feature complies with applicable Canadian laws and is not classified as a game of chance or lottery. By using this feature, you acknowledge and accept these terms.
        </div>
    </div>

    <style>
    .container {
        max-width: 900px;
        margin: 0 auto;
        padding: 2rem;
        background: rgba(0, 0, 0, 0.8);
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        color: #fff;
    }

    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid #00c853;
    }

    .header h1 {
        margin: 0;
        color: #00c853;
    }

    .nav-links {
        display: flex;
        gap: 1rem;
        align-items: center;
        color: #ccc;
    }

    .nav-links a {
        color: #fff;
        text-decoration: none;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
    }

    .nav-links a:hover {
        background: rgba(0, 200, 83, 0.2);
        transform: translateY(-2px);
    }

    .slot-reels {
        font-size: 2.2rem;
        display: flex;
        justify-content: center;
        gap: 2rem;
        margin: 1.5rem 0;
    }
    
    .slot-reels span {
        padding: 1rem 1.5rem;
        border: 3px solid #ffaad4;
        border-radius: 12px;
        background: linear-gradient(to bottom right, #fff0f6, #ffe4f4);
        box-shadow: 0 0 10px rgba(255, 120, 170, 0.4);
        font-weight: bold;
        color: #d63384;
        transition: transform 0.3s ease;
    }

    .result-text {
        font-weight: bold;
        margin-top: 1rem;
        min-height: 2em;
    }
    
    .result-text.big {
        font-size: 1.6rem;
        color: #ff5e8e;
        animation: pop 0.5s ease-in-out;
    }
    
    .result-text.narrow {
        font-size: 1.2rem;
        color: #999;
        animation: shake 0.6s ease-in-out;
    }

    @keyframes pop {
        0% { transform: scale(1); }
        50% { transform: scale(1.4); }
        100% { transform: scale(1); }
    }

    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-6px); }
        50% { transform: translateX(6px); }
        75% { transform: translateX(-4px); }
    }
    
    #spinBtn {
        background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        color: white;
        border: none;
        padding: 15px 35px;
        font-size: 18px;
        font-weight: bold;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 6px 20px rgba(255, 107, 107, 0.3);
    }

    #spinBtn:hover:not(:disabled) {
        background: linear-gradient(45deg, #ee5a24, #ff6b6b);
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
    }

    #spinBtn:disabled {
        background: #95a5a6;
        cursor: not-allowed;
        transform: none;
        box-shadow: 0 4px 10px rgba(149, 165, 166, 0.2);
    }
    
    .slot-area {
        text-align: center;
        padding: 2rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        margin-bottom: 2rem;
    }
    
    @media (max-width: 768px) {
        .container {
            padding: 1rem;
        }
        
        .header {
            flex-direction: column;
            gap: 1rem;
        }
        
        .slot-reels {
            gap: 1rem;
            font-size: 1.8rem;
        }
        
        .slot-reels span {
            padding: 0.8rem 1rem;
        }
        
        #spinBtn {
            padding: 12px 25px;
            font-size: 16px;
        }
    }
    </style>

    <script>
    const username = "<%= username %>";
    const r1 = document.getElementById('r1');
    const r2 = document.getElementById('r2');
    const r3 = document.getElementById('r3');
    const btn = document.getElementById('spinBtn');
    const result = document.getElementById('rewardResult');

    const fakeWords = [
        'Â•ΩËøêÊù•', 'ÂÜçÊù•‰∏ÄÊ¨°', 'Â∞±Â∑Æ‰∏ÄÁÇπ', '‰ªäÂ§©ÂøÖ‰∏≠', 'Â•ΩËøêÂä†ÊåÅ', 'ÂÜ≤È∏≠', 'ÁúºÁúãË¶Å‰∏≠', 'Â∑Æ‰∏ÄÁÇπÁÇπ'
    ];

    // Âä®ÁîªÈÄªËæë
    function animateSpin(finalReels, reward, callback) {
        let steps = 38;
        const interval = setInterval(() => {
            r1.textContent = fakeWords[Math.floor(Math.random() * fakeWords.length)];
            r2.textContent = fakeWords[Math.floor(Math.random() * fakeWords.length)];
            r3.textContent = fakeWords[Math.floor(Math.random() * fakeWords.length)];
            steps--;
            if (steps <= 0) {
                clearInterval(interval);
                [r1.textContent, r2.textContent, r3.textContent] = finalReels;

                const [a, b, c] = finalReels;
                if (reward === 'Ë∞¢Ë∞¢ÊÉ†È°æ' && ((a === b) || (b === c) || (a === c))) {
                    result.textContent = 'üò≠ Â∑Æ‰∏ÄÁÇπÁÇπÂ∞±‰∏≠‰∫ÜÔºÅ';
                    result.className = 'result-text narrow';
                } else if (reward !== 'Ë∞¢Ë∞¢ÊÉ†È°æ') {
                    result.textContent = `üéâ ÊÅ≠Âñú‰Ω†Ëé∑ÂæóÔºö${reward}`;
                    result.className = 'result-text big';
                    r1.style.transform = r2.style.transform = r3.style.transform = 'scale(1.4)';
                    setTimeout(() => {
                        r1.style.transform = r2.style.transform = r3.style.transform = 'scale(1)';
                    }, 500);
                } else {
                    result.textContent = 'üòÖ Ë∞¢Ë∞¢ÊÉ†È°æ';
                    result.className = 'result-text narrow';
                }

                callback();
            }
        }, 70);
    }

    function generateNonce(length = 16) {
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        return Array.from({ length }, () => chars[Math.floor(Math.random() * chars.length)]).join('');
    }

    btn.addEventListener('click', () => {
        const nonce = generateNonce();
        const timestamp = Math.floor(Date.now() / 1000);
        btn.disabled = true;
        result.textContent = 'üé∞ ÊäΩÂ•ñ‰∏≠...';
        result.className = 'result-text';

        fetch('https://slot-server-9682.onrender.com/spin', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, timestamp, nonce })
        })
        .then(res => res.json())
        .then(data => {
            if (!data.success) {
                result.textContent = `‚ùå ÊäΩÂ•ñÂ§±Ë¥•Ôºö${data.message}`;
                return;
            }

            const reels = data.reels || ['Ë∞¢Ë∞¢ÊÉ†È°æ', 'Ë∞¢Ë∞¢ÊÉ†È°æ', 'Ë∞¢Ë∞¢ÊÉ†È°æ'];
            const reward = data.reward;

            animateSpin(reels, reward, () => {});
        })
        .catch(err => {
            result.textContent = '‚ö†Ô∏è ÁΩëÁªúÈîôËØØÊàñÊúçÂä°Âô®Êú™ÂìçÂ∫î';
        })
        .finally(() => {
            btn.disabled = false;
        });
    });
    </script>

</body>
</html>